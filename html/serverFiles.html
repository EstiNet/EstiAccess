<style scoped>
    .list-group panel.active {
        background-color: #030;;
        border-color: #aed248;
    }
</style>
<div class="panel panel-default">
    <div class="panel-heading" id="curDirectory"></div>
    <div class="panel-body" id="fileSys">
        Panel content
    </div>
</div>
<script>
    refreshFiles();
    function refreshFiles(func){
        var remote = require('electron').remote;
        const util = remote.getGlobal('vars');
        var runAsync = require('run-async');
        var async = function () {
            var cur = util.sessionArray.get(util.curOpenSession).curDirectory;
            document.getElementById('curDirectory').innerHTML = cur + '<button class="btn btn-default" onclick="submitText()" id="commandButton" style="right: 0px;" type="button"><span class="glyphicon glyphicon-refresh" onclick="refreshFiles()" aria-hidden="true"></span></button>';
            if(cur != "./") {
                document.getElementById('fileSys').innerHTML = '<ul class="list-group" id="fileSysL"><div id="dirs"> <li class="list-group-item ftplist" poo="../" ondblclick="chDir(this)" onmouseleave="mouseOut(this)" onmouseover="mouseOver(this)"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> ../</li></div><div id="files"></div> </ul>';
            }
            else{
                document.getElementById('fileSys').innerHTML = '<ul class="list-group" id="fileSysL"><div id="dirs"></div><div id="files"></div></ul>';
            }
            util.requestCurServerFiles(cur, function (data) {
                var dirs = "", files = "";
                data.forEach(function(ob){
                    var isdir = ob.isDir;
                    if (isdir != undefined) {
                        if (isdir == "true") {
                            dirs += '<li class="list-group-item ftplist" poo="' + ob.name + '" ondblclick="chDir(this)" onmouseleave="mouseOut(this)" onmouseover="mouseOver(this)"><span class="badge">' + ob.size + 'kb</span> <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> ' + ob.name + '</li>';
                        }
                        else {
                            files += '<li class="list-group-item ftplist" onmouseleave="mouseOut(this)" onmouseover="mouseOver(this)"><span class="badge">' + ob.size + 'kb</span> <span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span> ' + ob.name + '</li>';
                        }
                    }
                });
                document.getElementById('dirs').innerHTML += dirs;
                document.getElementById('files').innerHTML = files;
                $('.list-group-item').css({'background-color': 'white', "transition": "background-color 0.3s ease"});
                if (func != undefined) func();
            });
        };
        async();
        //setTimeout(async, 0 );
    }
    function mouseOver(element){
        element.style.backgroundColor = '#1dc8e2';
    }
    function mouseOut(element){
        element.style.backgroundColor = 'white';
    }
    function chDir(element){
        var remote = require('electron').remote;
        const util = remote.getGlobal('vars');
        var str = element.getAttribute('poo');
        if(str != '../') {
            if(util.sessionArray.get(util.curOpenSession).curDirectory != './'){
                util.sessionArray.get(util.curOpenSession).curDirectory = util.sessionArray.get(util.curOpenSession).curDirectory + "/" + element.getAttribute('poo');
            }
            else{
                util.sessionArray.get(util.curOpenSession).curDirectory = util.sessionArray.get(util.curOpenSession).curDirectory + element.getAttribute('poo');
            }
        }
        else{
            var fixstr = util.sessionArray.get(util.curOpenSession).curDirectory;
            var a = 0;
            var newstr = "";
            var change = false;
            for(var i = fixstr.length-1; i >= 0; i--){
                if(change){
                    newstr = fixstr.charAt(i) + newstr;
                }
                else{
                    if(fixstr.charAt(i) == '/'){
                        change = true;
                        newstr = fixstr.charAt(i) + newstr;
                    }
                }
            }
            if(newstr != './' && newstr.charAt(newstr.length-1) == '/'){
                newstr = newstr.substring(0, newstr.length - 1);
            }
            util.sessionArray.get(util.curOpenSession).curDirectory = newstr;
        }
        $('#container-f').fadeOut(100, function(){
            $('#loader').show(function(){
                function dos(){
                    refreshFiles(function(){
                        $('#loader').hide();
                        $('#container-f').fadeIn(200);
                    });
                }
                dos();
                //setTimeout(dos, 0);
            });
        });
    }
</script>